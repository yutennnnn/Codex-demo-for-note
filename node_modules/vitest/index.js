const beforeAllFns = []
const tests = []

function beforeAll(fn) {
  beforeAllFns.push(fn)
}

function describe(_name, fn) {
  fn()
}

function it(name, fn) {
  tests.push({ name, fn })
}

function run() {
  let failed = false
  for (const fn of beforeAllFns) {
    try {
      fn()
    } catch (e) {
      console.error('beforeAll failed:', e)
      failed = true
    }
  }
  for (const t of tests) {
    try {
      t.fn()
      console.log('✓', t.name)
    } catch (e) {
      failed = true
      console.error('✕', t.name)
      console.error(e)
    }
  }
  if (failed) {
    process.exitCode = 1
  }
}

module.exports = { beforeAll, describe, it, run }
